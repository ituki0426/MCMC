# 2.そもそもモンテカルロ法とは

モンテカルロ法：乱数を用いた数値計算手法の総称

モンテカルロ法は素朴であるが故に適用限界がある。

限界を知れば，マルコフ連鎖モンテカルロ法の利点がよく理解できる。

## 2.1.乱数とは？

乱数：何らかの確率分布P(X)に従ってランダムに生成される数字の列

ランダム：過去の履歴によらずｘの値が決まること

ex）サイコロ

## 2.1.1.一様乱数

区間 [a, b] の間の実数を等確率で与える乱数を一様乱数と言います．

### 2.1.2.ガウス乱数（正規乱数）

確率が一定の関数に従って変わるような乱数も有用です。

その一例として、ガウス関数

$$
e^{-x^2}
$$

に従って確率が変わるガウス乱数（正規乱数）を考える。

あとで述べる中心極限定理のために、ガウス関数は必然的にあらゆる場面に顔をだす。

![](image/図2.1.png)

この関数を-∞から+∞で積分すると、

$$
\int_{-\infty}^{\infty} e^{-x^2} \, dx = \sqrt{\pi}
$$

となる。

そこで、

$$
P(x) = \frac{e^{-x^2}}{\sqrt{\pi}}
$$


のように積分値が１になるように規格化すればｘの確率分布と解釈できます。

より一般に、分布の幅を規定するパラメータとして𝜎（シグマ、標準偏差）、分布の中心を規定するパラメータとして 𝜇（ミュー、平均）を用いれば、

$$
P_{\sigma}(x) = \frac{e^{-\frac{(x-\mu)^2}{2\sigma^2}}}{\sqrt{2\pi\sigma}}
$$

## 2.1.3.乱数と疑似乱数の違い

## 2.2.一様乱数を用いた積分

乱数を使って素朴なモンテカルロ法に基づいた計算をしてみる。


## 2.2.1.一様乱数を用いた円周率の計算

![](image/図2.4.png)
シンプルなモンテカルロ法がうまく機能する例として、乱数を使って図２．４に灰色で示した扇形の面積を評価する。

この領域は半径が円のちょうど1/4なので、面積はπ/4となるはず。


## 2.2.2.一様乱数を用いた定積分

次に、y=f(x)という関数の定積分

$$
\int_a^b f(x)dx
$$

を考えてみる。

![](image/図1.1.png)

積分の定義に忠実に従うなら、図1.1のように短冊形に切り、長方形の面積の輪で積分を近似するところですが、乱数を使うと次のように計算できます。

xをaとbの間の一様乱数とします。

乱数をxを一つ選んでf(x)を計算してもでたらめな値が得られるだけですが、乱数をたくさん作ったらどうなるか？

$$
x^{(1)},x^{(2)}...,x^{(K)}
$$

というK個の乱数は、Kが大きければ、aとbの間にムラなく散らばると期待される。

すると平均値

$$
\frac{1}{K} \sum_{k=1}^{K} f(x^{(k)})
$$


は

$$
\frac{1}{b - a} \int_{a}^{b} f(x)dx \,
$$


の良い近似になるはずです。

またKの極限をとれば、


$$
\lim_{K \to \infty} \frac{1}{K} \sum_{k=1}^{K} f(x^{(k)}) = \frac{1}{b - a} \int_{a}^{b} f(x)dx \, 
$$

とまる。

例として、a=0、b=1、$f(x) = \sqrt{1 - x^2}$ を考えてみる。

$$
\lim_{K \to \infty} \frac{1}{K} \sum_{k=1}^{K} \sqrt{1 - (x^{(k)})^2} = \int_{0}^{1} \sqrt{1-x^2}dx \, 
$$

これは先ほど計算した扇形の面積と同じで，4\πになるはず。

```python
import numpy as np


def main():
    n_iter = 1000
    n_in = 0
    for k in range(1, n_iter + 1):
        x_k = np.random.rand()
        f_x = np.sqrt(1 - x_k**2)
        n_in += f_x
        if k % 100 == 0:
            print("Iteration: ", k, "Pi/4: ", n_in / k)


if __name__ == "__main__":
    main()

```

## 2.2.3.ガウス積分~重点サンプリングが重要になる例

ここまでの例は素朴な方法がうまく機能していましたが、素朴な方法がうまくいかない例として、ガウス関数

$$
\frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}}
$$

を積分する。

この関数は、一般化されたガウス関数

$$
P_{\sigma}(x) = \frac{e^{-\frac{(x-\mu)^2}{2\sigma^2}}}{\sqrt{2\pi\sigma}}
$$

𝜇（ミュー、平均）、𝜎（シグマ、標準偏差）において、

> 𝜇（ミュー、平均）= 0

> 𝜎（シグマ、標準偏差） = 1

としたものです。

### ・素朴なモンテカルロ法は無駄が多い

この関数

$$
P_{\sigma}(x) = \frac{e^{-\frac{(x-\mu)^2}{2\sigma^2}}}{\sqrt{2\pi\sigma}}
$$

を-aからaまで積分してみる。

区間[-a,a]の一様乱数を

## 2.4.2.ガウス分布から得られる期待値

ガウス分布

$$
P(x) = \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}}
$$

の下で期待値を計算してみる。

一般の関数f(x)について、定義より

$$
\langle f(x) \rangle = \int_{-\infty}^{\infty} f(x) P(x) dx = \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\infty} f(x) e^{-\frac{x^2}{2}} dx
$$

$$

=\lim_{K \to \infty} \frac{1}{K} \sum_{k=1}^{K} f(x^{(k)})


$$
です。

ただし、

$$
x^{(1)},x^{(2)},...
$$
はボックスミュラー法で生成するとします。

実際にガウス乱数を生成してみれば $<x>=0$ 、 $<x^2> = 1$ が簡単に確認できる。
（後ほど、マルコフ連鎖モンテカルロ法でも同じ計算をする）

期待値ではなく積分そのものを計算する場合は、非積分関数をg(x)とすれば

$$
\int_{-\infty}^{\infty} dx g(x) = \int_{-\infty}^{\infty} dx \left( g(x) \cdot \sqrt{2\pi e + \frac{x^2}{2}} \right) \frac{e^{-\frac{x^2}{2}}}{\sqrt{2\pi}}
$$
$$
= \left\langle g(x) \cdot \sqrt{2\pi e + \frac{x^2}{2}} \right\rangle
$$

という関係式を利用して期待値と積分を関係づけることができます。

これは、4.5節で説明するより強力な手法の特殊な場合と思うことができます。

一様乱数を持ちいた積分の計算式